% This code is based on an example provided by Giulio Moro, April 20 2015.

Fs=44100;
t = 1/Fs;
t2 = t*t;
q = 4.32; % q of 4.32 is for 1/3 octaves.

f=[22.4, 28.2, 35.5, 47.7, 56.2, 70.8, 89.1, 112, 141, 178, 224, 282, 355, 447, 562, 708, 891, 1122, 1413, 1778, 2239, 2818, 3548, 4467, 5623, 7079, 8913, 11220];
geoMeans(1)=sqrt(22.4*28.2);
geoMeans(2)=sqrt(28.2*35.5);
geoMeans(3)=sqrt(35.5*47.7);
geoMeans(4)=sqrt(47.7*56.2);
geoMeans(5)=sqrt(56.2*70.8);
geoMeans(6)=sqrt(70.8*89.1);
geoMeans(7)=sqrt(89.1*112);
geoMeans(8)=sqrt(112*141);
geoMeans(9)=sqrt(141*178);
geoMeans(10)=sqrt(178*224);
geoMeans(11)=sqrt(224*282);
geoMeans(12)=sqrt(282*355);
geoMeans(13)=sqrt(355*447);
geoMeans(14)=sqrt(447*562);
geoMeans(15)=sqrt(562*708);
geoMeans(16)=sqrt(708*891);
geoMeans(17)=sqrt(891*1122);
geoMeans(18)=sqrt(1122*1413);
geoMeans(19)=sqrt(1413*1778);
geoMeans(20)=sqrt(1778*2239);
geoMeans(21)=sqrt(2239*2818);
geoMeans(22)=sqrt(2818*3548);
geoMeans(23)=sqrt(3548*4467);
geoMeans(24)=sqrt(4467*5623);
geoMeans(25)=sqrt(5623*7079);
geoMeans(26)=sqrt(7079*8913);

clear co
i=1;
  [B,A]=butter(2,f(i)/22050,'low');
  co(i,1:2)=A(2:3);
  co(i,3:5)=B(:);

for i=2:27
  [B,A]=butter(1,[f(i:i+1)]/22050,'bandpass');
  co(i,1:2)=A(2:3);
  co(i,3:5)=B(:);
end

i=28;
  [B,A]=butter(2,f(i)/22050,'high');
  co(i,1:2)=A(2:3);
  co(i,3:5)=B(:);
 

co=[ones(28,1) co];
F=co;
figure(2)
clf
hold on
x=[1;zeros(1023,1)];
for i=1:28
  x=20*log10(abs(freqz(F(i,4:6),F(i,1:3))));
  plot((0:511)*22050/512,x);
end
axis([20 20000 -60 0]);
set(gca,'xscale','log')
title('coefficients from Matlab')
grid on
print('-dpng','matlabCoeff.png')
hold off
  
  
F=[-1.995492, 0.995497, 0.000003, 0.000005, 0.000003
-1.999054, 0.999070, 0.000465, 0.000000, -0.000465
-1.998804, 0.998830, 0.000585, 0.000000, -0.000585
-1.998382, 0.998428, 0.000786, 0.000000, -0.000786
-1.998084, 0.998148, 0.000926, 0.000000, -0.000926
-1.997566, 0.997668, 0.001166, 0.000000, -0.001166
-1.996905, 0.997066, 0.001467, 0.000000, -0.001467
-1.996059, 0.996313, 0.001843, 0.000000, -0.001843
-1.994958, 0.995361, 0.002320, 0.000000, -0.002320
-1.993506, 0.994147, 0.002926, 0.000000, -0.002926
-1.991626, 0.992641, 0.003680, 0.000000, -0.003680
-1.989139, 0.990745, 0.004627, 0.000000, -0.004627
-1.985822, 0.988365, 0.005818, 0.000000, -0.005818
-1.981350, 0.985375, 0.007312, 0.000000, -0.007312
-1.975305, 0.981655, 0.009173, 0.000000, -0.009173
-1.966908, 0.976958, 0.011521, 0.000000, -0.011521
-1.955255, 0.971116, 0.014442, 0.000000, -0.014442
-1.938781, 0.963820, 0.018090, 0.000000, -0.018090
-1.915281, 0.954760, 0.022620, 0.000000, -0.022620
-1.881591, 0.943621, 0.028189, 0.000000, -0.028189
-1.832577, 0.929946, 0.035027, 0.000000, -0.035027
-1.761289, 0.913453, 0.043274, 0.000000, -0.043274
-1.656991, 0.893855, 0.053073, 0.000000, -0.053073
-1.504912, 0.871277, 0.064362, 0.000000, -0.064362
-1.284969, 0.846519, 0.076741, 0.000000, -0.076741
-0.971026, 0.821617, 0.089192, 0.000000, -0.089192
-0.533774, 0.800925, 0.099537, 0.000000, -0.099537
0.032551, 0.171760, 0.284802, -0.569605, 0.284802
];
F=[ones(28,1) F];
figure(1)
clf
hold on
x=[1;zeros(1023,1)];
for i=1:28
  x=20*log10(abs(freqz(F(i,4:6),F(i,1:3))));
  plot((0:511)/512*22050,x);
end
axis([20 20000 -60 0]);
set(gca,'xscale','log')
grid on
hold off
title('coefficients from C')
print('-dpng','astridCoeff.png')